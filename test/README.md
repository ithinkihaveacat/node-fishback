Not very happy with this test code here--it's quite ugly and difficult to read.
But I find that code to test async code is often more difficult to write than
the async code in the first place.

There's an interesting proxy test suite at
<http://coad.measurement-factory.com/> that I will investigate at some point.
Not free, but free for OS projects.
